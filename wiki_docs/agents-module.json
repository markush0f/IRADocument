{
  "id": "agents-module",
  "title": "Agents Module Reference",
  "description": "Comprehensive documentation of the Agents module which includes pipeline execution, tool management, and analysis functionalities.",
  "content_markdown": "# Agents Module Reference\n\n## Overview\nThe Agents module provides functionality to execute analysis pipelines, manage tools, and process project data through a flexible and efficient architecture.\n\n## File Analysis\n\n### File: discovery_pipeline.py\n- **Pipeline Execution**: Implements project discovery pipeline stages with dynamic execution defined by `active_stages`, allowing customization based on user configuration.\n- **Tech Stack Analysis**: Utilizes `TechnologyScanner` for repository analysis, gathering relevant technology data to enhance the efficiency of analysis stages.\n- **Prompt Management**: Maps analysis stages to specific prompt files using `_get_prompt_for_stage`, ensuring the correct prompts are loaded for accurate analysis.\n\n### File: agent_executor.py\n- **Tool Execution**: Manages dynamic tool execution through `AgentExecutor`, permitting registration and invocation of tools at runtime.\n- **Message Handling**: Tracks conversation history, saving user inputs, LLM responses, and tool results to maintain contextual continuity.\n- **Error Handling**: Implements structured error handling and logging for transparency and debugging in the agent's workflow.\n\n### File: tools/registry.py\n- **Tool Management**: Implements `ToolRegistry`, allowing storage of registered tool definitions with JSON schema definitions for type safety.\n- **Schema Generation**: Dynamically generates models for JSON schemas using Pydantic to serialize and validate function parameters.\n- **Logging**: Integrates logging to monitor actions like tool registration through `get_logger`.\n- **Singleton Pattern**: Implements a singleton instance for global access throughout the application.\n\n### File: tools/project_tools.py\n- **Project Management**: Features asynchronous functions to manage project life cycles, interacting with the database via `ProjectService`.\n- **Database Interaction**: Uses `AsyncSessionLocal` to handle database sessions asynchronously.\n- **Error Handling**: Implements error messages for missing projects in `get_project_details` function.\n\n### File: tools/file_tools.py\n- **File Management**: Implements asynchronous tools for file registrations and directory listings via the `FileService`.\n- **Database Interaction**: Similar to previous tools, utilizes `AsyncSessionLocal` for asynchronous session management.\n- **File Handling**: Employs `aiofiles` for non-blocking file I/O in `read_file_content`.\n- **Security Checks**: Implements checks to ensure paths accessed are within project root structure.\n- **Error Handling**: Returns error messages for file access issues.\n\n### File: tools/relation_tools.py\n- **Relation Management**: Provides functions for managing architectural relationships between components via `RelationService`.\n- **Database Interaction**: Uses `AsyncSessionLocal` for database session management.\n- **Data Handling**: Outputs lists of relationships including `from`, `to`, and `type` details.\n\n### File: tools/fact_tools.py\n- **Fact Management**: Defines tools to register and retrieve facts about a project, using `FactService`.\n- **Data Handling**: Constructs fact payloads in `register_fact` and handles JSON parsing in fact listing.\n- **Database Interaction**: Uses `AsyncSessionLocal` for efficient database operation management.\n- **Error Handling**: Structures responses in `list_project_facts` to return crucial fields.\n\n### File: tools/analysis_tools.py\n- **Analysis Functionality**: Defines tools for analyzing a project's tech stack and repository structure, utilizing `AgentExecutor`.\n- **Dependencies**: Leverages imports like `LLMFactory` for client creation and `PromptLoader` for retrieving prompts.\n- **Configuration**: Adjusts language model client settings based on environment variables.\n- **Prompt Management**: Loads prompts dynamically from the filesystem.\n\n### File: core/types.py\n- **Type Definition**: Defines a type alias `AnalysisStage` for allowed values, improving pipeline management and code readability.\n\n### File: core/prompt_loader.py\n- **File Loading**: Defines a directory for prompt files and a method to read prompts, with error handling for missing files.\n\n### File: core/factory.py\n- **Client Management**: Implements `get_client` factory method to create LLM client instances dynamically.\n\n### File: core/base.py\n- **Abstract Base Class**: Provides `BaseLLMClient` with essential asynchronous methods for LLM interactions, enforcing a clear interface.\n\n### File: core/ollama_client.py\n- **Client Implementation**: Implements `OllamaClient`, extending `BaseLLMClient` and providing specific async methods for generating responses.\n\n### File: core/pipeline.py\n- **Pipeline Management**: Defines `BasePipeline`, managing analysis stages execution and aggregating results in a structured dictionary.\n\n### File: core/openai_client.py\n- **API Integration**: Uses `AsyncOpenAI` for interaction with OpenAI's API, ensuring secure access with proper key management.\n- **Asynchronous Programming**: Implements non-blocking methods for efficient API communication.\n- **Message Handling**: Constructs structured message payloads for context consistency.\n- **Error Logging**: Incorporates error handling that logs failures during API operations.\n- **Streaming Responses**: Supports streaming response functionality for real-time interactions.\n\n### File: miner/agent.py\n- **Agent Functionality**: Implements `MinerAgent` using `AgentExecutor` for file analysis and conclusion extraction.\n- **Asynchronous Execution**: Includes async methods for simultaneous processing, enhancing performance.\n- **Error Handling and Fallback**: Implements logging of failures and fallback logic for data extraction.\n- **Batch Analysis**: Supports batch processing via `analyze_batch` method.\n- **Data Schemas**: Defines JSON schemas for structured conclusions.\n\n### File: miner/schema.py\n- **Data Modeling**: Uses Pydantic to ensure strict validation for analysis results.\n- **Field Descriptions**: Provides descriptions for attributes in models to enhance documentation.\n- **List and Type Safety**: Employs type annotations for data integrity.\n\n### File: miner/prompts.py\n- **Prompt Definition**: Establishes `MINER_SYSTEM_PROMPT`, outlining the role of the Miner for extraction tasks.\n- **Guidelines for Extraction**: Defines detailed rules and quality assurance principles for data extraction.\n- **Focus Areas**: Outlines important points for analysis critical to documentation.\n\n## Dependencies\nThis module interacts with the following modules:\n- `app/agents/core`: Contains utility functions and classes for managing analysis and LLM interactions.\n- `app/agents/tools`: Provides functionalities for managing tools and their integrations within the agent framework.\n- `app/agents/miner`: Includes specific implementations for mining data and analyzing project components.\n\n---\nFor updates and detailed design decisions, refer to the code comments and commit history for each file.",
  "diagram_mermaid": null,
  "related_files": []
}