{
  "id": "core-module",
  "title": "Agent Core Module Reference",
  "description": "Detailed documentation of the Agent Core module, including tools for managing agents, projects, files, relations, facts, and analysis.",
  "content_markdown": "## Overview\nThe Agent Core module offers a set of tools and classes designed to manage agents, projects, files, relations, and analysis functionalities, ensuring an efficient pipeline for project documentation and analysis.\n\n## Files Analysis\n\n### File: registry.py\n- **Tool Management**: Implements a `ToolRegistry` class that manages tool definitions registered through the `tool` decorator, ensuring type safety and documentation for functions.\n- **Schema Generation**: Utilizes Pydantic's `create_model` method to create models for generating JSON schemas from type hints, facilitating automatic serialization and validation.\n- **Logging**: Integrates a logging system to monitor tool registration actions, leveraging `get_logger` to create a module-specific logger.\n- **Singleton Pattern**: Contains a singleton instance of `ToolRegistry` called `registry` for global access within the application.\n\n### File: project_tools.py\n- **Project Management**: Provides asynchronous functions for managing project lifecycles, including `create_project`, `list_projects`, and `get_project_details`, which interact with the database via `ProjectService`.\n- **Database Interaction**: Uses `AsyncSessionLocal` for handling asynchronous database sessions, ensuring efficient data management in concurrent environments.\n- **Error Handling**: Implements basic error handling in the `get_project_details` function to return errors when a project is not found.\n\n### File: file_tools.py\n- **File Management**: Features asynchronous methods such as `register_file`, `list_project_files`, and `read_file_content` to manage file registrations and directory listings, utilizing `FileService` for database operations.\n- **Database Interaction**: Also employs `AsyncSessionLocal` for managing asynchronous sessions while performing file-related tasks.\n- **File Handling**: Uses the `aiofiles` library for non-blocking file I/O in `read_file_content`, facilitating efficient file reads.\n- **Security**: Incorporates security checks in `list_directory_content` to ensure all accesses are contained within the project root structure.\n- **Error Handling**: Includes structured error handling to provide informative error messages for issues like file not found and access denied errors.\n\n### File: relation_tools.py\n- **Relation Management**: Defines asynchronous functions to manage architectural relationships between project components, with tools like `register_relation` and `list_project_relations` utilizing `RelationService`.\n- **Database Interaction**: Handles sessions asynchronously through `AsyncSessionLocal`, ensuring efficient retrieval and creation of relation records.\n- **Data Handling**: Constructs outputs for `list_project_relations`, detailing relationships including `from`, `to`, and `type`.\n\n### File: fact_tools.py\n- **Fact Management**: Manages facts related to projects with asynchronous functions like `register_fact` and `list_project_facts`, utilizing `FactService` for interactions with the database.\n- **Data Handling**: Constructs payloads in `register_fact` for additional details and uses JSON parsing for accurate fact listings.\n- **Database Interaction**: Utilizes `AsyncSessionLocal` for efficient management during fact registration and retrieval.\n- **Error Handling**: Implements structured error handling in `list_project_facts` to return well-structured results with fields such as ID, type, source, and confidence.\n\n### File: analysis_tools.py\n- **Analysis Functionality**: Implements `analyze_tech_stack` and `browse_repository` to analyze a projectâ€™s tech stack and repository structure, utilizing `AgentExecutor` for task management.\n- **Dependencies**: Includes imports like `LLMFactory`, `AgentExecutor`, and `PromptLoader`, indicating a modular design.\n- **Configuration**: Configures the language model client using settings from `app.core.config`, specifically the `llm_provider` setting.\n- **Prompt Management**: Loads prompts dynamically using `PromptLoader`, allowing contextual customization based on project ID.\n\n### File: agent.py\n(Located in `app/agents/miner`)\n- **Agent Functionality**: Features the `MinerAgent` class utilizing `AgentExecutor`, analyzing files and extracting structured conclusions based on user-defined prompts.\n- **Asynchronous Execution**: Implements `analyze_file` and `analyze_batch` for efficient, non-blocking file analysis operations.\n- **Error Handling**: Incorporates robust error handling, enabling fallback logic using regex to recover from potential failures.\n- **Batch Analysis**: Supports the analysis of multiple files in one go, optimizing the submission process.\n- **Data Schemas**: Defines JSON schemas for outputs using Pydantic to maintain data structure consistency.\n\n### File: schema.py\n(Located in `app/agents/miner`)\n- **Data Modeling**: Implements structured data models with Pydantic, ensuring strict validation and clarity for analysis results.\n- **Field Descriptions**: Utilizes `Field` to provide descriptions for model attributes, enhancing self-documentation.\n- **List and Type Safety**: Employs type annotations to ensure data integrity and prevent runtime errors.\n\n### File: prompts.py\n(Located in `app/agents/miner`)\n- **Prompt Definition**: Establishes a `MINER_SYSTEM_PROMPT` outlining the roles and responsibilities of the Miner.\n- **Guidelines for Extraction**: Provides guidance on data extraction, emphasizing the need for accuracy and objectivity.\n- **Quality Assurance**: Incorporates a philosophy of reliability in data extraction processes.\n- **Focus Areas**: Defines focal points for analyses to ensure that significant aspects of the code are documented.\n\n### File: discovery_pipeline.py\n(Located in `app/agents`)\n- **Pipeline Execution**: Implements stages for project discovery with customizable execution order via `active_stages`.\n- **Tech Stack Analysis**: Uses `TechnologyScanner` to gather relevant tech data, streamlining the analysis process.\n- **Prompt Management**: Ensures correct prompts are loaded for each analysis stage, maintaining relevance in execution.\n\n### File: agent_executor.py\n(Located in `app/agents`)\n- **Tool Execution**: Facilitates dynamic execution of tools through `AgentExecutor`, enabling integration with LLM requests.\n- **Message Handling**: Tracks conversation history, preserving context throughout interactions.\n- **Error Handling**: Logs errors during execution to aid in operational debugging.\n\n## Dependencies\n- The module primarily interacts with:\n  - `app.core`: For logging, database management, and configuration.\n  - `app.agents.miner`: For management of miner-related functionalities, including analysis and data extraction.\n  - Various services like `ProjectService`, `FileService`, `RelationService`, and `FactService` for database interactions and project management.\n  - The `aiofiles` library for asynchronous file operations.\n  - Pydantic for data modeling and schema validation.",
  "diagram_mermaid": null,
  "related_files": [
    "registry.py",
    "project_tools.py",
    "file_tools.py",
    "relation_tools.py",
    "fact_tools.py",
    "analysis_tools.py",
    "agent.py",
    "schema.py",
    "prompts.py",
    "discovery_pipeline.py",
    "agent_executor.py"
  ]
}